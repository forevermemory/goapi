package service

import (
	"net/http"
	"time"

	"github.com/gin-gonic/gin"
)

func route(f func(ctx *gin.Context) interface{}) gin.HandlerFunc {
	return func(context *gin.Context) {
		context.JSON(http.StatusOK, f(context))
	}
}

// InitRouter 初始化gin路由
func InitRouter() *gin.Engine {

	gin.SetMode(gin.ReleaseMode)

	r := gin.Default()
	r.Use(Cors()) // 跨域

	r.Static("static", "./static")

	{
		// 播放视频记录
		record := r.Group("/record")
		record.GET("/", route(ListRecord))
		record.GET("/:id", route(GetRecordByID))
		record.POST("/", route(AddRecord))
		record.PUT("/:id", route(UpdateRecord))
		record.DELETE("/:id", route(UpdateRecord))
	}

	r.GET("/test", func(c *gin.Context) {
		c.Writer.WriteString(time.Now().String())
	})

	return r
}
